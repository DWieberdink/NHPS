<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NHPS Dashboard - Data & Logic Viewer</title>
    <style>
        body {
            font-family: 'Franklin Gothic Book', 'Franklin Gothic', 'Arial Narrow', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #007cbf, #005a8b);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: bold;
        }
        
        .header p {
            margin: 10px 0 0 0;
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }
        
        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            background: none;
            border: none;
            font-family: 'Franklin Gothic Book', 'Franklin Gothic', 'Arial Narrow', Arial, sans-serif;
            font-size: 16px;
            font-weight: bold;
            color: #666;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .nav-tab.active {
            background: white;
            color: #007cbf;
            border-bottom: 3px solid #007cbf;
        }
        
        .nav-tab:hover:not(.active) {
            background: #e9ecef;
            color: #333;
        }
        
        .tab-content {
            display: none;
            padding: 30px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .section h2 {
            color: #007cbf;
            border-bottom: 2px solid #007cbf;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        .section h3 {
            color: #333;
            margin-top: 25px;
            margin-bottom: 15px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 14px;
        }
        
        .data-table th {
            background: #007cbf;
            color: white;
            padding: 12px 8px;
            text-align: left;
            font-weight: bold;
        }
        
        .data-table td {
            padding: 10px 8px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .data-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .data-table tr:hover {
            background: #e3f2fd;
        }
        
        .sortable {
            cursor: pointer;
            user-select: none;
            position: relative;
        }
        
        .sortable:hover {
            background: #005a8b !important;
        }
        
        .sortable::after {
            content: "‚Üï";
            position: absolute;
            right: 8px;
            color: rgba(255,255,255,0.7);
            font-size: 12px;
        }
        
        .sortable.asc::after {
            content: "‚Üë";
            color: white;
        }
        
        .sortable.desc::after {
            content: "‚Üì";
            color: white;
        }
        
        .logic-box {
            background: #f8f9fa;
            border-left: 4px solid #007cbf;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .logic-box h4 {
            margin-top: 0;
            color: #007cbf;
        }
        
        .formula {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            border: 1px solid #bbdefb;
        }
        
        .metric-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .metric-card h4 {
            margin-top: 0;
            color: #007cbf;
        }
        
        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #007cbf;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 16px;
            font-family: 'Franklin Gothic Book', 'Franklin Gothic', 'Arial Narrow', Arial, sans-serif;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            transition: all 0.2s ease;
            z-index: 1000;
        }
        
        .back-btn:hover {
            background: #005a8b;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .search-box {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-family: 'Franklin Gothic Book', 'Franklin Gothic', 'Arial Narrow', Arial, sans-serif;
            font-size: 14px;
            margin-bottom: 20px;
        }
        
        .search-box:focus {
            outline: none;
            border-color: #007cbf;
        }
        
        .highlight {
            background: yellow;
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        .decision-flowchart {
            background: #f8f9fa;
            border: 2px solid #007cbf;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .decision-flowchart h4 {
            margin-top: 0;
            color: #007cbf;
            text-align: center;
        }
        
        .flow-step {
            background: white;
            border: 1px solid #007cbf;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
            position: relative;
        }
        
        .flow-step::before {
            content: "‚Üí";
            position: absolute;
            left: -15px;
            top: 50%;
            transform: translateY(-50%);
            background: #007cbf;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .flow-step:first-child::before {
            display: none;
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="window.close()">‚Üê Back to Dashboard</button>
    
    <div class="container">
        <div class="header">
            <h1>üìä NHPS Dashboard Data & Logic</h1>
            <p>Comprehensive view of all data sources, calculations, and decision logic</p>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('overview')">Overview</button>
            <button class="nav-tab" onclick="showTab('decision-data')">Decision Data</button>
            <button class="nav-tab" onclick="showTab('map-data')">Map Data</button>
            <button class="nav-tab" onclick="showTab('logic')">Decision Logic</button>
            <button class="nav-tab" onclick="showTab('student-assignment')">Student Assignment</button>
            <button class="nav-tab" onclick="showTab('formulas')">Formulas & Calculations</button>
        </div>
        
        <!-- Overview Tab -->
        <div id="overview" class="tab-content active">
            <div class="section">
                <h2>üìã Dashboard Overview</h2>
                <p>The NHPS Dashboard uses two primary data sources to evaluate schools and provide strategic decision recommendations:</p>
                
                <div class="metric-card">
                    <h4>üéØ Primary Data Sources</h4>
                    <ul>
                        <li><strong>Decision Data Export.csv</strong> - Contains evaluation metrics, growth data, and building scores</li>
                        <li><strong>Map_Export.csv</strong> - Contains geographic data, capacity, and current enrollment</li>
                    </ul>
                </div>
                
                <div class="metric-card">
                    <h4>üîß Key Features</h4>
                    <ul>
                        <li><strong>School Decision Evaluation</strong> - Evaluates schools based on multiple criteria</li>
                        <li><strong>Scenario Modeling</strong> - Tests the impact of different portfolio decisions</li>
                        <li><strong>Interactive Flowchart</strong> - Visualizes decision logic for individual schools</li>
                        <li><strong>Geographic Analysis</strong> - Maps schools and analyzes travel distances</li>
                    </ul>
                </div>
                
                <div class="metric-card">
                    <h4>üìä Decision Categories</h4>
                    <ul>
                        <li><strong>Candidate for Closure/Merger</strong> - Schools recommended for closure or merger</li>
                        <li><strong>Building Investment</strong> - Schools needing facility improvements</li>
                        <li><strong>Programmatic Investment</strong> - Schools needing program enhancements</li>
                        <li><strong>Building & Programmatic Investments</strong> - Schools needing both facility and program improvements</li>
                        <li><strong>Candidate for Building Addition</strong> - Schools that could expand on-site</li>
                        <li><strong>Ongoing Monitoring & Evaluation</strong> - Schools requiring continued assessment</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- Decision Data Tab -->
        <div id="decision-data" class="tab-content">
            <div class="section">
                <h2>üìä Decision Data Export.csv</h2>
                <p>This file contains the primary evaluation metrics used in the decision logic.</p>
                
                <input type="text" class="search-box" id="decisionSearch" placeholder="Search schools..." onkeyup="filterTable('decisionTable', 'decisionSearch')">
                
                <table class="data-table" id="decisionTable">
                    <thead>
                        <tr>
                            <th class="sortable" onclick="sortTable('decisionTable', 0)">Building Name</th>
                            <th class="sortable" onclick="sortTable('decisionTable', 1)">Utilization</th>
                            <th class="sortable" onclick="sortTable('decisionTable', 2)">Enrollment Growth (2014-2024)</th>
                            <th class="sortable" onclick="sortTable('decisionTable', 3)">Expected Utilization (10yrs)</th>
                            <th class="sortable" onclick="sortTable('decisionTable', 4)">Distance to Underutilized Schools</th>
                            <th class="sortable" onclick="sortTable('decisionTable', 5)">Building Threshold</th>
                            <th class="sortable" onclick="sortTable('decisionTable', 6)">Adequate Program Offer</th>
                            <th class="sortable" onclick="sortTable('decisionTable', 7)">2014 Enrollment</th>
                        </tr>
                    </thead>
                    <tbody id="decisionTableBody">
                        <!-- Data will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Map Data Tab -->
        <div id="map-data" class="tab-content">
            <div class="section">
                <h2>üó∫Ô∏è Map Data Export.csv</h2>
                <p>This file contains geographic and capacity data for mapping and spatial analysis.</p>
                
                <input type="text" class="search-box" id="mapSearch" placeholder="Search schools..." onkeyup="filterTable('mapTable', 'mapSearch')">
                
                <table class="data-table" id="mapTable">
                    <thead>
                        <tr>
                            <th class="sortable" onclick="sortTable('mapTable', 0)">Building Name</th>
                            <th class="sortable" onclick="sortTable('mapTable', 1)">School Level</th>
                            <th class="sortable" onclick="sortTable('mapTable', 2)">Latitude</th>
                            <th class="sortable" onclick="sortTable('mapTable', 3)">Longitude</th>
                            <th class="sortable" onclick="sortTable('mapTable', 4)">Capacity</th>
                            <th class="sortable" onclick="sortTable('mapTable', 5)">Enrollment</th>
                            <th class="sortable" onclick="sortTable('mapTable', 6)">Available Seats</th>
                            <th class="sortable" onclick="sortTable('mapTable', 7)">Building Score</th>
                        </tr>
                    </thead>
                    <tbody id="mapTableBody">
                        <!-- Data will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Logic Tab -->
        <div id="logic" class="tab-content">
            <div class="section">
                <h2>üß† Decision Logic Flow</h2>
                <p>The dashboard uses a multi-step evaluation process to determine the appropriate action for each school.</p>
                
                <div class="decision-flowchart">
                    <h4>Decision Flowchart Logic</h4>
                    
                    <div class="flow-step">
                        <strong>Step 1: Enrollment Check</strong><br>
                        If enrollment ‚â§ threshold ‚Üí <strong>Candidate for Closure/Merger</strong><br>
                        If enrollment > threshold ‚Üí Continue to Step 2
                    </div>
                    
                    <div class="flow-step">
                        <strong>Step 2: Utilization Check</strong><br>
                        If utilization > 65% ‚Üí Continue to Step 3<br>
                        If utilization ‚â§ 65% ‚Üí Check enrollment growth
                    </div>
                    
                    <div class="flow-step">
                        <strong>Step 3: High Utilization Check</strong><br>
                        If utilization > 95% ‚Üí Check 5-year projections<br>
                        If utilization ‚â§ 95% ‚Üí Check building quality
                    </div>
                    
                    <div class="flow-step">
                        <strong>Step 4: Projection & Quality Checks</strong><br>
                        Evaluate 5-year utilization projections and building quality scores
                    </div>
                    
                    <div class="flow-step">
                        <strong>Step 5: Distance & Program Analysis</strong><br>
                        Check proximity to other underutilized schools and program offerings
                    </div>
                    
                    <div class="flow-step">
                        <strong>Step 6: Final Decision</strong><br>
                        Assign one of the six decision categories based on all criteria
                    </div>
                </div>
                
                <div class="logic-box">
                    <h4>üéØ Decision Categories Explained</h4>
                    <ul>
                        <li><strong>Candidate for Closure/Merger</strong> - Schools with low enrollment, declining growth, or poor building conditions that may be candidates for closure or merger with other schools</li>
                        <li><strong>Building Investment</strong> - Schools with adequate programs but poor building conditions requiring facility improvements</li>
                        <li><strong>Programmatic Investment</strong> - Schools with good buildings but insufficient program offerings</li>
                        <li><strong>Building & Programmatic Investments</strong> - Schools requiring both facility and program improvements</li>
                        <li><strong>Candidate for Building Addition</strong> - Schools with good conditions and programs that could expand on their current site</li>
                        <li><strong>Ongoing Monitoring & Evaluation</strong> - Schools that meet most criteria but require continued assessment</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- Student Assignment Tab -->
        <div id="student-assignment" class="tab-content">
            <div class="section">
                <h2>üë• Student Assignment Logic</h2>
                <p>The dashboard models how students would choose schools when one or more schools close, using weighted factors to predict student preferences and optimize school assignments.</p>
                
                <div class="metric-card">
                    <h4>üéØ Assignment Objectives</h4>
                    <ul>
                        <li><strong>Model Student Choice</strong> - Predict which schools students would choose when their current school closes</li>
                        <li><strong>Weighted Decision Factors</strong> - Use adjustable sliders to model different student preferences</li>
                        <li><strong>Capacity Optimization</strong> - Ensure chosen schools can accommodate displaced students</li>
                        <li><strong>Travel Distance Minimization</strong> - Prioritize schools closer to student locations</li>
                    </ul>
                </div>
                
                <div class="decision-flowchart">
                    <h4>Student Assignment Process (School Closure Scenario)</h4>
                    
                    <div class="flow-step">
                        <strong>Step 1: Identify Displaced Students</strong><br>
                        ‚Ä¢ Identify students from schools marked for closure<br>
                        ‚Ä¢ Load student locations and preferences<br>
                        ‚Ä¢ Calculate distances to all remaining schools
                    </div>
                    
                    <div class="flow-step">
                        <strong>Step 2: Calculate School Attractiveness Scores</strong><br>
                        ‚Ä¢ Apply weighted factors using slider values<br>
                        ‚Ä¢ Calculate distance-based attractiveness<br>
                        ‚Ä¢ Factor in school capacity and current utilization
                    </div>
                    
                    <div class="flow-step">
                        <strong>Step 3: Student Choice Modeling</strong><br>
                        ‚Ä¢ Model student preferences based on weighted scores<br>
                        ‚Ä¢ Consider multiple choice options per student<br>
                        ‚Ä¢ Account for school capacity constraints
                    </div>
                    
                    <div class="flow-step">
                        <strong>Step 4: Assignment Optimization</strong><br>
                        ‚Ä¢ Use weighted algorithm to assign students<br>
                        ‚Ä¢ Balance student preferences with school capacity<br>
                        ‚Ä¢ Minimize total travel distance while respecting weights
                    </div>
                    
                    <div class="flow-step">
                        <strong>Step 5: Impact Analysis</strong><br>
                        ‚Ä¢ Calculate new school utilization rates<br>
                        ‚Ä¢ Analyze travel distance impacts<br>
                        ‚Ä¢ Report capacity and efficiency improvements
                    </div>
                </div>
                
                <div class="metric-card">
                    <h4>üìç Distance Calculation Methods</h4>
                    <ul>
                        <li><strong>Straight-line Distance</strong> - Direct geographic distance between points</li>
                        <li><strong>Road Network Distance</strong> - Actual driving/walking distance using road networks</li>
                        <li><strong>Travel Time</strong> - Estimated travel time considering traffic and transportation modes</li>
                        <li><strong>Public Transit</strong> - Distance considering public transportation routes</li>
                    </ul>
                </div>
                
                <div class="logic-box">
                    <h4>‚öñÔ∏è Weighting Logic & Slider Controls</h4>
                    <p>The student assignment algorithm uses weighted factors to model how students would choose schools when their current school closes. Each factor can be adjusted using sliders to test different scenarios:</p>
                    
                    <div class="formula">Total Attractiveness Score = (Distance Weight √ó Distance Score) + (Capacity Weight √ó Capacity Score) + (Quality Weight √ó Quality Score) + (Program Weight √ó Program Score)</div>
                    
                    <h5>üéõÔ∏è Adjustable Weight Factors:</h5>
                    <ul>
                        <li><strong>Distance Weight (0-100%)</strong> - How much students prioritize proximity to home</li>
                        <li><strong>Capacity Weight (0-100%)</strong> - How much students prefer schools with available space</li>
                        <li><strong>Building Quality Weight (0-100%)</strong> - How much students value modern facilities</li>
                        <li><strong>Program Weight (0-100%)</strong> - How much students value specific program offerings</li>
                    </ul>
                    
                    <h5>üìä Scoring Components:</h5>
                    <ul>
                        <li><strong>Distance Score</strong> - Inverse of travel distance (closer = higher score)</li>
                        <li><strong>Capacity Score</strong> - Available seats relative to total capacity</li>
                        <li><strong>Quality Score</strong> - Building condition rating (lower building score = higher quality)</li>
                        <li><strong>Program Score</strong> - Number and variety of academic/extracurricular programs</li>
                    </ul>
                </div>
                
                <div class="metric-card">
                    <h4>‚öñÔ∏è Capacity Constraints</h4>
                    <ul>
                        <li><strong>Maximum Capacity</strong> - Schools cannot exceed their designed capacity</li>
                        <li><strong>Optimal Utilization</strong> - Target 85-95% utilization for efficient operations</li>
                        <li><strong>Minimum Viable Size</strong> - Schools need minimum enrollment to remain operational</li>
                        <li><strong>Grade Level Balancing</strong> - Maintain appropriate class sizes across grade levels</li>
                    </ul>
                </div>
                
                <div class="logic-box">
                    <h4>üîß Assignment Algorithm Details</h4>
                    <p>The student assignment uses a weighted scoring algorithm to model realistic student choice behavior:</p>
                    <ol>
                        <li><strong>School Closure Identification</strong> - Identify which schools are marked for closure/merger</li>
                        <li><strong>Student Displacement</strong> - Calculate how many students need to be reassigned</li>
                        <li><strong>Attractiveness Calculation</strong> - For each student-school pair, calculate weighted attractiveness score</li>
                        <li><strong>Preference Ranking</strong> - Rank schools by attractiveness for each displaced student</li>
                        <li><strong>Capacity-Constrained Assignment</strong> - Assign students to their highest-ranked available school</li>
                        <li><strong>Impact Analysis</strong> - Calculate new utilization rates and travel distances</li>
                    </ol>
                    
                    <h5>üéØ Algorithm Features:</h5>
                    <ul>
                        <li><strong>Realistic Choice Modeling</strong> - Students choose based on weighted preferences, not just distance</li>
                        <li><strong>Capacity Awareness</strong> - Algorithm respects school capacity limits</li>
                        <li><strong>Scenario Testing</strong> - Sliders allow testing different student preference scenarios</li>
                        <li><strong>Impact Quantification</strong> - Measures how closures affect remaining schools</li>
                    </ul>
                </div>
                
                <div class="metric-card">
                    <h4>üìä Assignment Metrics (School Closure Impact)</h4>
                    <ul>
                        <li><strong>Displaced Students</strong> - Number of students affected by school closures</li>
                        <li><strong>Average Travel Distance Increase</strong> - How much further students must travel</li>
                        <li><strong>Capacity Utilization Changes</strong> - How school closures affect remaining school utilization</li>
                        <li><strong>Student Distribution</strong> - How displaced students are distributed across remaining schools</li>
                        <li><strong>Preference Satisfaction</strong> - How well student preferences are met given constraints</li>
                        <li><strong>Efficiency Gains</strong> - Overall system efficiency improvements from closures</li>
                    </ul>
                </div>
                
                <div class="logic-box">
                    <h4>üéØ Special Considerations (School Closure Context)</h4>
                    <ul>
                        <li><strong>Magnet School Preferences</strong> - Students may choose schools based on specific magnet programs rather than proximity</li>
                        <li><strong>Special Education Continuity</strong> - Students with special needs require schools with appropriate programs</li>
                        <li><strong>Sibling Co-enrollment</strong> - Families may prefer to keep siblings together when schools close</li>
                        <li><strong>Transportation Infrastructure</strong> - Existing bus routes and transportation capacity affect school choice</li>
                        <li><strong>Community Ties</strong> - Students may prefer schools where they have existing social connections</li>
                        <li><strong>School Reputation</strong> - Perceived school quality influences student choice beyond physical factors</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- Formulas Tab -->
        <div id="formulas" class="tab-content">
            <div class="section">
                <h2>üßÆ Formulas & Calculations</h2>
                <p>Detailed explanations of all calculations and thresholds used in the decision logic.</p>
                
                <div class="metric-card">
                    <h4>üìà Utilization Rate</h4>
                    <div class="formula">Utilization = Current Enrollment / Capacity</div>
                    <p><strong>Threshold:</strong> 65% (default)<br>
                    <strong>High Utilization Threshold:</strong> 95% (default)<br>
                    <strong>Purpose:</strong> Identifies underutilized and overcrowded schools</p>
                </div>
                
                <div class="metric-card">
                    <h4>üìä Enrollment Growth (2014-2024)</h4>
                    <div class="formula">Growth Rate = (2024 Enrollment - 2014 Enrollment) / 2014 Enrollment</div>
                    <p><strong>Threshold:</strong> 0% (default)<br>
                    <strong>Purpose:</strong> Identifies schools with declining enrollment trends</p>
                </div>
                
                <div class="metric-card">
                    <h4>üèóÔ∏è Building Quality Score</h4>
                    <div class="formula">Lower scores = Better building condition</div>
                    <p><strong>Threshold:</strong> 1.5 (default)<br>
                    <strong>Purpose:</strong> Identifies schools needing facility improvements</p>
                </div>
                
                <div class="metric-card">
                    <h4>üìç Distance to Underutilized Schools</h4>
                    <div class="formula">Distance in miles to nearest underutilized school</div>
                    <p><strong>Threshold:</strong> 1.0 mile (default)<br>
                    <strong>Purpose:</strong> Identifies schools that could serve students from nearby underutilized schools</p>
                </div>
                
                <div class="metric-card">
                    <h4>üìö Adequate Program Offerings</h4>
                    <div class="formula">Count of academic and extracurricular programs</div>
                    <p><strong>Threshold:</strong> 2 programs (default)<br>
                    <strong>Purpose:</strong> Identifies schools needing program enhancements</p>
                </div>
                
                <div class="metric-card">
                    <h4>üîÆ Expected Utilization (10 years)</h4>
                    <div class="formula">Projected utilization based on enrollment trends and capacity</div>
                    <p><strong>Threshold:</strong> 95% (default)<br>
                    <strong>Purpose:</strong> Identifies schools that may become overcrowded in the future</p>
                </div>
                
                <div class="logic-box">
                    <h4>‚öôÔ∏è Adjustable Parameters</h4>
                    <p>All thresholds can be adjusted using the sliders in the dashboard:</p>
                    <ul>
                        <li><strong>Enrollment Threshold:</strong> 0-500 students (default: 200)</li>
                        <li><strong>Utilization Threshold:</strong> 0-100% (default: 65%)</li>
                        <li><strong>High Utilization Threshold:</strong> 0-120% (default: 95%)</li>
                        <li><strong>Enrollment Growth Threshold:</strong> -300% to +300% (default: 0%)</li>
                        <li><strong>Projected Utilization Threshold:</strong> 0-150% (default: 95%)</li>
                        <li><strong>Distance Threshold:</strong> 0-5 miles (default: 1.0)</li>
                        <li><strong>Building Quality Threshold:</strong> 0-3 (default: 1.5)</li>
                        <li><strong>Program Minimum:</strong> 0-10 programs (default: 2)</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab switching functionality
        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }
        
        // Table filtering functionality
        function filterTable(tableId, searchId) {
            const table = document.getElementById(tableId);
            const searchBox = document.getElementById(searchId);
            const filter = searchBox.value.toLowerCase();
            const tbody = table.querySelector('tbody');
            const rows = tbody.querySelectorAll('tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(filter)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        // Table sorting functionality
        function sortTable(tableId, columnIndex) {
            const table = document.getElementById(tableId);
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            const headers = table.querySelectorAll('th.sortable');
            
            // Remove active class from all headers
            headers.forEach(header => {
                header.classList.remove('asc', 'desc');
            });
            
            // Get current sort direction
            const currentHeader = headers[columnIndex];
            const isAscending = currentHeader.classList.contains('asc');
            
            // Set new sort direction
            if (isAscending) {
                currentHeader.classList.add('desc');
            } else {
                currentHeader.classList.add('asc');
            }
            
            // Sort the rows
            rows.sort((a, b) => {
                const aValue = a.cells[columnIndex].textContent.trim();
                const bValue = b.cells[columnIndex].textContent.trim();
                
                // Handle numeric values (including percentages)
                const aNum = parseFloat(aValue.replace(/[^\d.-]/g, ''));
                const bNum = parseFloat(bValue.replace(/[^\d.-]/g, ''));
                
                if (!isNaN(aNum) && !isNaN(bNum)) {
                    // Numeric comparison
                    if (isAscending) {
                        return bNum - aNum; // Descending
                    } else {
                        return aNum - bNum; // Ascending
                    }
                } else {
                    // String comparison
                    if (isAscending) {
                        return bValue.localeCompare(aValue); // Descending
                    } else {
                        return aValue.localeCompare(bValue); // Ascending
                    }
                }
            });
            
            // Re-append sorted rows
            rows.forEach(row => {
                tbody.appendChild(row);
            });
        }
        
        // CSV parsing function that handles quoted fields
        function parseCSVRow(row) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < row.length; i++) {
                const char = row[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current.trim());
            return result;
        }
        
        // Load decision data
        async function loadDecisionData() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/DWieberdink/NHPS/main/Decision%20Data%20Export.csv');
                const csvText = await response.text();
                
                const allRows = csvText.split('\n');
                const rows = allRows.slice(1); // Skip header
                
                const tbody = document.getElementById('decisionTableBody');
                tbody.innerHTML = ''; // Clear existing content
                
                rows.forEach((row, index) => {
                    if (row.trim()) {
                        const cells = parseCSVRow(row);
                        const tr = document.createElement('tr');
                        
                        // Format the data for display
                        const formattedCells = [
                            cells[1] || 'N/A', // Building Name (now index 1, was 0)
                            cells[2] ? (parseFloat(cells[2]) * 100).toFixed(1) + '%' : 'N/A', // Utilization (now index 2, was 1)
                            cells[3] ? (parseFloat(cells[3]) * 100).toFixed(1) + '%' : 'Nrollment Growth (now index 3, was 2)
                            cells[4] ? (parseFloat(cells[4]) * 100).toFixed(1) + '%' : 'N/A', // Expected Utilization (now index 4, was 3)
                            cells[5] || 'N/A', // Distance (now index 5, was 4)
                            cells[6] || 'N/A', // Building Threshold (now index 6, was 5)
                            cells[7] || 'N/A', // Program Offer (now index 7, was 6)
                            cells[12] || 'N/A'  // 2014 Enrollment (now index 12, was 11)
                        ];
                        
                        formattedCells.forEach(cell => {
                            const td = document.createElement('td');
                            td.textContent = cell;
                            tr.appendChild(td);
                        });
                        
                        tbody.appendChild(tr);
                    }
                });
            } catch (error) {
                console.error('Error loading decision data:', error);
                document.getElementById('decisionTableBody').innerHTML = '<tr><td colspan="8">Error loading data</td></tr>';
            }
        }
        
        // Load map data
        async function loadMapData() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/DWieberdink/NHPS/main/Map_Export.csv');
                const csvText = await response.text();
                
                const allRows = csvText.split('\n');
                const rows = allRows.slice(1); // Skip header
                
                const tbody = document.getElementById('mapTableBody');
                tbody.innerHTML = ''; // Clear existing content
                
                rows.forEach((row, index) => {
                    if (row.trim()) {
                        const cells = parseCSVRow(row);
                        const tr = document.createElement('tr');
                        
                        // Format the data for display
                        const formattedCells = [
                            cells[1] || 'N/A', // Building Name (column 1)
                            cells[2] || 'N/A', // School Level (column 2)
                            cells[3] || 'N/A', // Latitude (column 3)
                            cells[4] || 'N/A', // Longitude (column 4)
                            cells[5] || 'N/A', // Capacity (column 5)
                            cells[6] || 'N/A', // Enrollment (column 6)
                            cells[7] || 'N/A', // Available Seats (column 7)
                            cells[8] || 'N/A'  // Building Score (column 8)
                        ];
                        
                        formattedCells.forEach(cell => {
                            const td = document.createElement('td');
                            td.textContent = cell;
                            tr.appendChild(td);
                        });
                        
                        tbody.appendChild(tr);
                    }
                });
            } catch (error) {
                console.error('Error loading map data:', error);
                document.getElementById('mapTableBody').innerHTML = '<tr><td colspan="8">Error loading data</td></tr>';
            }
        }
        
        // Load data when page loads
        window.addEventListener('load', () => {
            loadDecisionData();
            loadMapData();
        });
    </script>
</body>
</html>
